<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" sizes="16x16" type="image/png" href="../../_static/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Excel import/export example &mdash; Add-On Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme_zeiss.css?v=dc6cf2b8" />

  
    <link rel="canonical" href="https://zeissiqs.github.io/zeiss-inspect-addon-api/2023/python_examples/misc/excel_example.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="point_pixel_transformations" href="point_pixel_transformations.html" />
    <link rel="prev" title="dialog_reopen_example" href="dialog_reopen_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Add-On Documentation
              <img src="../../_static/zeiss-logo-rgb.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../news/news.html">What’s New</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/python_api_introduction/python_api_introduction.html">ZEISS INSPECT Python API Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/python_api_introduction/selecting_elements.html">Selecting elements in scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/using_add_on_editor/using_add_on_editor.html">Using the Add-on Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/add_on_file_format/add_on_file_format.html">Add-on file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/add_on_documentation/add_on_documentation.html">Documenting Add-ons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/using_vscode_editor/using_vscode_editor.html">Using Visual Studio Code as an add-on editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/python_api_introduction/user_defined_dialogs.html">User-defined Dialogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/python_api_introduction/creating_wizard_dialogs.html">Creating wizard dialogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/using_gui_libraries/using_gui_libraries.html">Using an additional Python GUI library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/scripted_elements/scripted_elements_toc.html">Scripted elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/python_api_introduction/using_script_resources.html">Using script resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/stages/stages.html">Working with stages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/project_keywords/project_keywords.html">Project keywords handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/using_shared_environments/using_shared_environments.html">Using shared environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/using_wheelhouses/using_wheelhouses.html">Using Python wheelhouses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/adding_workspaces_to_addons/adding_workspaces_to_addons.html">Adding workspaces to add-ons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/localization/localization.html">Localization of Add-ons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/starting_options/starting_options.html">Software and script starting options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/testing_addons/testing_addons.html">Testing add-ons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/scripting_solutions/scripting_solutions.html">Scripting solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/faq/faq.html">Frequently asked questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">ZEISS INSPECT Python API Examples Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_interfaces.html">data_interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dialog_widgets.html">dialog_widgets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../misc.html">misc</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dialog_reopen_example.html">dialog_reopen_example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Excel import/export example</a></li>
<li class="toctree-l2"><a class="reference internal" href="point_pixel_transformations.html">point_pixel_transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql_example.html">sql_example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../script_icons.html">script_icons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../script_resources.html">script_resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripted_actuals.html">scripted_actuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripted_checks.html">scripted_checks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/python_api.html">ZEISS INSPECT Python API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/scripted_elements_api.html">Scripted elements API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/resource_api.html">gom.Resource API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Add-On Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../misc.html">misc</a></li>
      <li class="breadcrumb-item active">Excel import/export example</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="excel-import-export-example">
<h1>Excel import/export example<a class="headerlink" href="#excel-import-export-example" title="Link to this heading"></a></h1>
<p><img alt="Excel Example Figure" src="../../_images/excel_example.png" /></p>
<section id="short-description">
<h2>Short description<a class="headerlink" href="#short-description" title="Link to this heading"></a></h2>
<p>This example demonstrates how to read and write Excel files from an Add-on. The Excel file access is implemented using <a class="reference external" href="https://pypi.org/project/openpyxl/">openpyxl</a>.</p>
<p>For demonstration purposes, project keywords are read from or written to an Excel file, but the example can be used as a template for other items.</p>
<p><img alt="Define Project Keywords Dialog" src="../../_images/define_project_keywords.png" /></p>
</section>
<section id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Link to this heading"></a></h2>
<p>Both example scripts check if a project has been opened and quit with an error message dialog if this is not the case:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;project&#39;</span><span class="p">):</span>
    <span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">execute_user_defined_dialog</span> <span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;no_project.gdlg&#39;</span><span class="p">)</span>
    <span class="n">quit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="excel-read-example-import-project-keywords-py">
<h2>Excel read example: <code class="docutils literal notranslate"><span class="pre">import_project_keywords.py</span></code><a class="headerlink" href="#excel-read-example-import-project-keywords-py" title="Link to this heading"></a></h2>
<p>Two packages are imported from <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
<span class="kn">from</span> <span class="nn">openpyxl.utils.cell</span> <span class="kn">import</span> <span class="n">coordinate_from_string</span><span class="p">,</span> <span class="n">column_index_from_string</span>
</pre></div>
</div>
<p>The current project keywords and their values are listed with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Current keywords --&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_keywords</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A dialog is used to request the Excel file to be opened:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RESULT</span><span class="o">=</span><span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">execute_user_defined_dialog</span> <span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;dialog.gdlg&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opening&quot;</span><span class="p">,</span> <span class="n">RESULT</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
<p>The workbook is opened from the Excel file and a worksheet object <code class="docutils literal notranslate"><span class="pre">ws</span></code> is created:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">RESULT</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="s1">&#39;Sheet&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>As a tradeoff between simplicity and flexibility, the script allows to configure the cells which contain keywords, but assumes that the keyword descriptions and values are located at fixed positions in the adjacent cells:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cells containing the keywords</span>
<span class="c1"># - descriptions are expected in column+1</span>
<span class="c1"># - values are expected in column+2</span>
<span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s2">&quot;A2&quot;</span><span class="p">,</span>
	<span class="s2">&quot;A3&quot;</span><span class="p">,</span>
	<span class="s2">&quot;A4&quot;</span><span class="p">,</span>
  <span class="c1">#...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Cells can be accessed by their coordinates (e.g. “A1”) or by row and column. The method <code class="docutils literal notranslate"><span class="pre">coordinate_from_string()</span></code> splits the coordinate into row and column (e.g. <code class="docutils literal notranslate"><span class="pre">coordinate_from_string(&quot;A1&quot;)</span> <span class="pre">=&gt;</span> <span class="pre">(&quot;A&quot;,</span> <span class="pre">1)</span></code>). The method <code class="docutils literal notranslate"><span class="pre">column_index_from_string()</span></code> converts a column name into
a column index (e.g. <code class="docutils literal notranslate"><span class="pre">column_index_from_string(&quot;A&quot;)</span> <span class="pre">=&gt;</span> <span class="pre">1</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get keyword by cell name, e.g. cell=&quot;A1&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Get column as a string</span>
<span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">coordinate_from_string</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

<span class="c1"># Get column index</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">column_index_from_string</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="c1"># Keyword description - next to keyword</span>
<span class="n">desc</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Value - next to keyword description</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>In the array <code class="docutils literal notranslate"><span class="pre">gom.app.project.project_keywords</span></code>, the keywords have the prefix <code class="docutils literal notranslate"><span class="pre">user_</span></code>, but this prefix must be omitted for the method <code class="docutils literal notranslate"><span class="pre">gom.script.sys.set_project_keywords()</span></code>.</p>
<p>The script distinguishes the following cases:</p>
<ol class="arabic simple">
<li><p>The keyword in the Excel file is new</p></li>
<li><p>The keyword in the Excel file already exists, but its value has changed</p></li>
<li><p>The keyword in the Excel file already exists, but its description has changed</p></li>
<li><p>The keyword in the Excel file already exists and remains unchanged</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ukw</span> <span class="o">=</span> <span class="s2">&quot;user_&quot;</span> <span class="o">+</span> <span class="n">key</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">ukw</span> <span class="ow">in</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_keywords</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39; added&quot;</span><span class="p">)</span>
    <span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">set_project_keywords</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span><span class="p">},</span> <span class="n">keywords_description</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">desc</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ex_val</span> <span class="o">=</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ukw</span><span class="p">)</span>
    <span class="n">ex_desc</span> <span class="o">=</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;description(</span><span class="si">{</span><span class="n">ukw</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">ex_val</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">desc</span> <span class="o">==</span> <span class="n">ex_desc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39; - not changed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">ex_val</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">ex_val</span><span class="si">}</span><span class="s2">&#39; changed to &#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">set_project_keywords</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">desc</span> <span class="o">!=</span> <span class="n">ex_desc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> - description &#39;</span><span class="si">{</span><span class="n">ex_desc</span><span class="si">}</span><span class="s2">&#39; changed to &#39;</span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">set_project_keywords</span><span class="p">(</span><span class="n">keywords_description</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">desc</span><span class="p">})</span>
</pre></div>
</div>
<p>The steps described above are repeated for all Excel cells listed in <code class="docutils literal notranslate"><span class="pre">layout[]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">layout</span><span class="p">:</span>
    <span class="c1"># Get keyword, description and value</span>
    <span class="c1">#...</span>
    
    <span class="c1"># Convert data type, if required</span>
    <span class="c1">#...</span>
    
    <span class="c1"># Add or update project keywords</span>
    <span class="c1">#... </span>
</pre></div>
</div>
<p>Finally, the updated project keywords are listed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-- Updated keywords --&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_keywords</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="excel-write-example-export-project-keywords-py">
<h2>Excel write example: <code class="docutils literal notranslate"><span class="pre">export_project_keywords.py</span></code><a class="headerlink" href="#excel-write-example-export-project-keywords-py" title="Link to this heading"></a></h2>
<p>Two packages are imported from <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
<span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="n">Font</span>
</pre></div>
</div>
<p>The following code creates a workbook and writes text into three cells of the worksheet as a table header:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a workbook</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
	
<span class="c1"># Select the active worksheet</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
	
<span class="c1"># Create table header</span>
<span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Project Keyword&quot;</span>
<span class="n">ws</span><span class="p">[</span><span class="s1">&#39;B1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Description&quot;</span>
<span class="n">ws</span><span class="p">[</span><span class="s1">&#39;C1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span>
</pre></div>
</div>
<p>Next, the table header is formatted and the column widths are adjusted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change table header layout</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">]:</span>
    <span class="n">ws</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> 
    <span class="n">ws</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
<p>The script iterates over all project keywords and gets the values and keyword descriptions. A type conversion has been implemented for date entries. The method <code class="docutils literal notranslate"><span class="pre">ws.append([key,</span> <span class="pre">val,</span> <span class="pre">desc])</span></code> writes the variables <code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">val</span></code> and <code class="docutils literal notranslate"><span class="pre">desc</span></code> - which are combined into an array - to the next three cells of the worksheet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_keywords</span><span class="p">:</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">gom</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;description(</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="c1"># Remove prefix &#39;user_&#39; from key</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
		
    <span class="c1"># Special case - convert gom.Date to datetime-object</span>
    <span class="c1"># and format Excel cell accordingly </span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="n">gom</span><span class="o">.</span><span class="n">Date</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">number_format</span> <span class="o">=</span> <span class="s2">&quot;yyyy-mm-dd&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
</pre></div>
</div>
<p>Specific cells can be selected with <code class="docutils literal notranslate"><span class="pre">ws.cell(row=&lt;row&gt;,</span> <span class="pre">column=&lt;column&gt;)</span></code>. This can be used for</p>
<ul class="simple">
<li><p>Changing the content: <code class="docutils literal notranslate"><span class="pre">ws.cell(row=ws.max_row+2,</span> <span class="pre">column=1).value</span> <span class="pre">=</span> <span class="pre">f'Exported</span> <span class="pre">from</span> <span class="pre">{gom.app.application_name}'</span></code></p></li>
<li><p>Setting the font: <code class="docutils literal notranslate"><span class="pre">ws.cell(row=ws.max_row,</span> <span class="pre">column=1).font</span> <span class="pre">=</span> <span class="pre">Font(size=8)</span></code></p></li>
<li><p>Adjusting the cell format: <code class="docutils literal notranslate"><span class="pre">ws.cell(row=ws.max_row,</span> <span class="pre">column=2).number_format</span> <span class="pre">=</span> <span class="pre">&quot;yyyy-mm-dd&quot;</span></code></p></li>
<li><p>etc.</p></li>
</ul>
<p>Finally the prepared spreadsheet is written to a file. The file path has been requested previously with a dialog.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">RESULT1</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
<p>To handle the common case that the Excel file cannot been written by the script, because it it currently opened in the Excel software, a loop with exception handling has been implemented:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Repeat until file was written successfully or</span>
<span class="c1"># user has cancelled.</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># File selection dialog</span>
        <span class="n">RESULT1</span><span class="o">=</span><span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">execute_user_defined_dialog</span> <span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="p">{</span>
            <span class="c1">#...</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">gom</span><span class="o">.</span><span class="n">BreakError</span><span class="p">:</span>
        <span class="c1"># User has cancelled</span>
        <span class="k">break</span>

    <span class="c1"># ... create spreadsheet with project keywords ...</span>
    
    <span class="c1"># Try to write Excel file, this will fail if the file is still open in Excel!</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">RESULT1</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Notification dialog</span>
        <span class="n">RESULT</span><span class="o">=</span><span class="n">gom</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">execute_user_defined_dialog</span> <span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="p">{</span>
            <span class="c1">#...</span>
        <span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">retry</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dialog_reopen_example.html" class="btn btn-neutral float-left" title="dialog_reopen_example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="point_pixel_transformations.html" class="btn btn-neutral float-right" title="point_pixel_transformations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Carl Zeiss GOM Metrology GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
  <p></p>
  <div class="footer">
    <a href="https://www.gom.com/en/imprint" target="_blank" rel="noopener noreferrer">Imprint</a>
  </div>
  <jinja2.runtime.BlockReference object at 0x7fc30e3d1930>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>